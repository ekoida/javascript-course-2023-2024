<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product landing page</title>
    <link rel="icon" href="/favicon.ico" />
    <link rel="stylesheet" href="/style.css" />
  </head>
  <body>
    <script>
      fetch("/api/product")
        .then((response) => response.json())
        .then((json) => {
          const h1 = document.createElement("h1");
          h1.innerText = json.title;
          document.body.append(h1);

          const h2 = document.createElement("h2");
          h2.innerText = json.subtitle;
          document.body.append(h2);

          const img = document.createElement("img");
          img.src = json.image;
          document.body.append(img);

          const ul = document.createElement("ul");
          json.tags.forEach((tag) => {
            const li = document.createElement("li");
            li.innerText = tag;
            ul.append(li);
          });
          document.body.append(ul);

          const p = document.createElement("p");
          p.innerText = json.description;
          document.body.append(p);

          const price = document.createElement("p");
          price.innerText = `${json.price.amount} ${json.price.currency}`;
          document.body.append(price);

          const button = document.createElement("button");
          button.innerText = "ORDER";
          document.body.append(button);

          button.addEventListener("click", orderProduct);
        })
        .catch((error) => console.log(error));

      const orderProduct = () => {
        const form = document.createElement("form");

        const input = document.createElement("input");
        input.placeholder = "Enter your email...";

        const button = document.createElement("button");
        button.innerText = "Confirm Order";
        button.addEventListener("click", (e) => {
          e.preventDefault();
          fetch("/api/order", {
            method: "POST",
          })
            .then((response) => response.json())
            .then((json) => {
              alert(json.message);
            })
            .catch((err) => {
              alert("error");
            });
        });

        form.append(input);
        form.append(button);

        document.body.replaceChild(form, document.body.lastElementChild);
      };
    </script>
  </body>
</html>
